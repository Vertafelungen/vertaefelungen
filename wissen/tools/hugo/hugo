#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

OS_RAW="$(uname -s)"
ARCH_RAW="$(uname -m)"

case "${OS_RAW}" in
  Linux) OS="linux" ;;
  Darwin) OS="darwin" ;;
  *)
    echo "Unsupported OS: ${OS_RAW}" >&2
    exit 1
    ;;
esac

case "${ARCH_RAW}" in
  x86_64) ARCH="amd64" ;;
  aarch64|arm64) ARCH="arm64" ;;
  *)
    echo "Unsupported ARCH: ${ARCH_RAW}" >&2
    exit 1
    ;;
esac

DEST_BIN="${SCRIPT_DIR}/${OS}-${ARCH}/hugo"

if [[ ! -x "${DEST_BIN}" ]]; then
  "${SCRIPT_DIR}/install.sh"
fi

exec "${DEST_BIN}" "$@"
