{{/*
File: wissen/layouts/partials/product/gallery.html
Version: 2026-01-10 10:20 CET

Wichtig:
- Wir nutzen ausschließlich Page Resources (Leaf Bundle).
- Wir nutzen Permalinks für Bilder, um mit canonifyURLs und baseURL-Pfaden keine doppelten Präfixe wie /wissen/wissen/ zu erzeugen.
*/}}

{{- $altScratch := newScratch -}}
{{- with .Params.produkt.bilder -}}
  {{- range . -}}
    {{- $fn := .datei | default "" -}}
    {{- if $fn -}}
      {{- $alt := "" -}}
      {{- if eq $.Lang "de" -}}
        {{- $alt = (or .alt_de .alt_en "") -}}
      {{- else -}}
        {{- $alt = (or .alt_en .alt_de "") -}}
      {{- end -}}
      {{- $altScratch.Set $fn $alt -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- $images := .Resources.Match "*.{png,jpg,jpeg,webp}" -}}
{{- $images = sort $images "Name" -}}

{{- if gt (len $images) 0 -}}
<div class="product-gallery">
  {{- range $images -}}
    {{- $filename := path.Base .Name -}}
    {{- $alt := $altScratch.Get $filename -}}
    {{- if not $alt -}}
      {{- $stem := strings.TrimSuffix $filename (path.Ext $filename) -}}
      {{- $alt = replace (replace $stem "-" " ") "_" " " -}}
    {{- end -}}
    <figure class="product-gallery__item">
      <img
        src="{{ .Permalink | safeURL }}"
        alt="{{ $alt | plainify | safeHTMLAttr }}"
        loading="lazy"
        decoding="async"
      />
    </figure>
  {{- end -}}
</div>
{{- else -}}
<div class="product-gallery">
  <div class="w-full aspect-[4/3] bg-slate-50 border border-slate-200 rounded-2xl"></div>
</div>
{{- end -}}
