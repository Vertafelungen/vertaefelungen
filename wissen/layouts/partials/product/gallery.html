{{/* 
  File: wissen/layouts/partials/product/gallery.html
  Version: 2025-12-28 12:40 CET

  Rendert Produktbilder aus:
  1) .Params.produkt.bilder (SSOT-Metadaten: datei + alt_de/alt_en)
  2) Fallback: .Resources.ByType "image"
*/}}

{{- $p := .Params.produkt -}}
{{- $hasMetaImages := and $p $p.bilder (gt (len $p.bilder) 0) -}}

{{- if $hasMetaImages -}}
  <div class="product-gallery">
    {{- range $i, $img := $p.bilder -}}
      {{- $fn := $img.datei -}}
      {{- if $fn -}}
        {{- $res := $.Resources.GetMatch $fn -}}
        {{- $src := "" -}}
        {{- if $res -}}
          {{- $src = $res.RelPermalink -}}
        {{- else -}}
          {{- /* Fallback: Datei liegt im Output im gleichen Ordner wie die Seite */ -}}
          {{- $src = printf "%s%s" $.RelPermalink $fn -}}
        {{- end -}}

        {{- $alt := "" -}}
        {{- if eq $.Lang "de" -}}
          {{- $alt = (or $img.alt_de $img.alt_en $.Title) -}}
        {{- else -}}
          {{- $alt = (or $img.alt_en $img.alt_de $.Title) -}}
        {{- end -}}

        <figure class="product-gallery__item">
          <img src="{{ $src }}" alt="{{ $alt | safeHTMLAttr }}" loading="lazy" decoding="async" />
        </figure>
      {{- end -}}
    {{- end -}}
  </div>

{{- else -}}
  {{- /* Fallback: alle Bilder aus dem Leaf Bundle anzeigen */ -}}
  {{- with .Resources.ByType "image" -}}
    <div class="product-gallery">
      {{- range . -}}
        <figure class="product-gallery__item">
          <img src="{{ .RelPermalink }}" alt="{{ $.Title | safeHTMLAttr }}" loading="lazy" decoding="async" />
        </figure>
      {{- end -}}
    </div>
  {{- end -}}
{{- end -}}
