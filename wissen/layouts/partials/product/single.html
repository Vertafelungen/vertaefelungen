{{/*
  File: wissen/layouts/partials/product/single.html
  Purpose: Dedicated layout for product detail pages.
  Version: 2026-01-13 22:05 CET
*/}}

{{- $intro := or .Params.intro .Params.teaser .Params.subtitle -}}
{{- $shopURL := "" -}}
{{- with .Params.refs.source_shop -}}
  {{- $shopURL = . -}}
{{- end -}}

<article class="space-y-8">
  <nav class="text-sm text-slate-500" aria-label="Breadcrumb">
    <ol class="flex flex-wrap gap-2">
      <li>
        <a class="hover:text-slate-700" href="{{ .Site.Home.RelPermalink }}">Start</a>
      </li>
      {{- range .Ancestors.Reverse -}}
        {{- if not .IsHome -}}
          <li aria-hidden="true">/</li>
          <li>
            <a class="hover:text-slate-700" href="{{ .RelPermalink }}">{{ .Title }}</a>
          </li>
        {{- end -}}
      {{- end -}}
      <li aria-hidden="true">/</li>
      <li aria-current="page" class="text-slate-900">{{ .Title }}</li>
    </ol>
  </nav>

  <header class="space-y-4">
    <div class="space-y-2">
      <h1 class="text-3xl font-semibold text-slate-900">{{ .Title }}</h1>
      {{- if $intro -}}
        <p class="text-lg text-slate-600">{{ $intro | markdownify }}</p>
      {{- end -}}
    </div>

    {{- if isset .Params "produkt" -}}
      {{- if isset .Params.produkt "verfuegbar" -}}
        <div class="inline-flex items-center gap-2 text-sm">
          <span class="text-slate-500">Status:</span>
          {{- if .Params.produkt.verfuegbar -}}
            <span class="px-2 py-1 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200">Verfügbar</span>
          {{- else -}}
            <span class="px-2 py-1 rounded-full bg-amber-50 text-amber-700 border border-amber-200">Nicht verfügbar</span>
          {{- end -}}
        </div>
      {{- end -}}
    {{- end -}}
  </header>

  {{- partial "product/gallery.html" . -}}

  {{- with .Params.produkt.merkmale | default .Params.merkmale -}}
    <section class="space-y-3">
      <h2 class="text-xl font-semibold text-slate-900">Merkmale</h2>
      <ul class="list-disc pl-5 text-slate-700 space-y-1">
        {{- range $key, $value := . -}}
          <li>
            {{- if eq (printf "%T" $key) "string" -}}
              <strong>{{ $key }}:</strong> {{ $value }}
            {{- else -}}
              {{ $value }}
            {{- end -}}
          </li>
        {{- end -}}
      </ul>
    </section>
  {{- end -}}

  {{- with .Params.produkt.technikdaten | default .Params.technikdaten -}}
    <section class="space-y-3">
      <h2 class="text-xl font-semibold text-slate-900">Technikdaten</h2>
      <ul class="list-disc pl-5 text-slate-700 space-y-1">
        {{- range $key, $value := . -}}
          <li>
            {{- if eq (printf "%T" $key) "string" -}}
              <strong>{{ $key }}:</strong> {{ $value }}
            {{- else -}}
              {{ $value }}
            {{- end -}}
          </li>
        {{- end -}}
      </ul>
    </section>
  {{- end -}}

  <section class="prose max-w-none">
    {{ .Content }}
  </section>

  {{- $sectionPage := site.GetPage (printf "/%s/%s" .Lang .Section) -}}
  {{- if $sectionPage -}}
    <div class="prose max-w-none">
      <p><a href="{{ $sectionPage.RelPermalink }}">{{ i18n "home_tile_products_cta" }}</a></p>
    </div>
  {{- end -}}

  <section class="flex flex-wrap gap-4" aria-label="Produkt-CTAs">
    {{- if $shopURL -}}
      <a
        class="inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
        href="{{ $shopURL }}"
        target="_blank"
        rel="nofollow noopener"
      >
        Preise &amp; Varianten / im Shop ansehen
      </a>
    {{- end -}}

    {{/* Visualisierung-CTA entfernt, da visualisierung.md nicht (mehr) existieren soll. */}}
  </section>
</article>
