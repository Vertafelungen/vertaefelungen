<!--
File: wissen/layouts/partials/nav-drawer.html
Version: 2026-02-14 19:18 Europe/Berlin
Change:
- Robust label fallback: If menu item has Identifier but no i18n translation (or translation equals the key),
  fall back to .Name. Prevents empty labels ("dot" symptom) in drawer menus.
- Keep href resolution logic unchanged.
-->

<div class="nav-drawer" id="nav-drawer" data-testid="nav-drawer" aria-hidden="true">
  <div class="nav-drawer__overlay" data-testid="nav-drawer-overlay"></div>
  <div class="nav-drawer__panel" role="dialog" aria-modal="true" aria-label="{{ i18n "header_nav_label" }}" tabindex="-1">
    <div class="nav-drawer__section" data-testid="drawer-main-links">
      <p class="nav-drawer__title">{{ i18n "header_nav_label" }}</p>
      <ul class="nav-drawer__list">
        {{- range .Site.Menus.main -}}
          {{- $label := .Name -}}
          {{- with .Identifier -}}
            {{- $t := i18n . -}}
            {{- if and $t (ne $t .) -}}
              {{- $label = $t -}}
            {{- end -}}
          {{- end -}}
          {{- $href := "" -}}
          {{- if .Page -}}
            {{- $href = .Page.RelPermalink -}}
          {{- else -}}
            {{- $raw := .URL -}}
            {{- if or (hasPrefix $raw "http://") (hasPrefix $raw "https://") -}}
              {{- $href = $raw -}}
            {{- else -}}
              {{- $href = $raw | relLangURL -}}
              {{- if and (not (hasSuffix $href "/")) (not (in $href "?")) (not (in $href "#")) -}}
                {{- $href = printf "%s/" $href -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
          <li><a href="{{ $href }}">{{ $label }}</a></li>
        {{- end -}}
      </ul>
    </div>

    <div class="nav-drawer__section" data-testid="drawer-footer-links">
      <p class="nav-drawer__title">{{ i18n "drawer_footer_title" }}</p>
      <ul class="nav-drawer__list">
        {{- range .Site.Menus.footer -}}
          {{- $label := .Name -}}
          {{- with .Identifier -}}
            {{- $t := i18n . -}}
            {{- if and $t (ne $t .) -}}
              {{- $label = $t -}}
            {{- end -}}
          {{- end -}}
          {{- $href := "" -}}
          {{- if .Page -}}
            {{- $href = .Page.RelPermalink -}}
          {{- else -}}
            {{- $raw := .URL -}}
            {{- if or (hasPrefix $raw "http://") (hasPrefix $raw "https://") -}}
              {{- $href = $raw -}}
            {{- else -}}
              {{- $href = $raw | relLangURL -}}
              {{- if and (not (hasSuffix $href "/")) (not (in $href "?")) (not (in $href "#")) -}}
                {{- $href = printf "%s/" $href -}}
              {{- end -}}
            {{- end -}}
          {{- end -}}
          <li><a href="{{ $href }}">{{ $label }}</a></li>
        {{- end -}}
      </ul>
    </div>
  </div>
</div>
