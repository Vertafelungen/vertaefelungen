{{/* 
  File: wissen/layouts/_default/section.html
  Version: 2025-12-26 18:32 CET
*/}}

{{ define "title" }}{{ .Title }} – {{ .Site.Title }}{{ end }}

{{ define "main" }}
<article>
  <h1>{{ .Title }}</h1>

  {{ with .Description }}
    <p style="max-width: 70ch; color:#444;">{{ . }}</p>
  {{ end }}

  {{ if .Content }}
    <div style="max-width: 80ch;">
      {{ .Content }}
    </div>
    <hr/>
  {{ end }}

  {{/* Labels i18n-light */}}
  {{- $lblSections := "Unterkategorien" -}}
  {{- $lblPages := "Einträge" -}}
  {{- if eq .Lang "en" -}}
    {{- $lblSections = "Subcategories" -}}
    {{- $lblPages = "Entries" -}}
  {{- end -}}

  {{/* Subsections */}}
  {{ with .Sections }}
    <h2>{{ $lblSections }}</h2>
    <ul>
      {{ range .ByTitle }}
        <li>
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          {{ with .Description }}<span style="color:#666;"> – {{ . }}</span>{{ end }}
        </li>
      {{ end }}
    </ul>
  {{ end }}

  {{/* Regular pages (filter README/readme) */}}
  {{- $pages := slice -}}
  {{- range .RegularPages -}}
    {{- $bn := "" -}}
    {{- with .File }}{{- $bn = .BaseFileName -}}{{- end -}}
    {{- if ne (lower $bn) "readme" -}}
      {{- $pages = $pages | append . -}}
    {{- end -}}
  {{- end -}}

  {{ if gt (len $pages) 0 }}
    <h2>{{ $lblPages }}</h2>

    <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 12px;">
      {{ range $pages.ByTitle }}
        {{- $p := . -}}
        {{- $img := "" -}}
        {{- with $p.Params.produkt.bilder -}}
          {{- $first := index . 0 -}}
          {{- with $p.Resources.GetMatch $first.datei -}}
            {{- $img = .RelPermalink -}}
          {{- end -}}
        {{- end -}}

        <div style="border:1px solid #e5e5e5; border-radius:10px; padding:12px;">
          {{ if $img }}
            <a href="{{ $p.RelPermalink }}">
              <img src="{{ $img }}" alt="{{ $p.Title }}" loading="lazy" style="width:100%; height:auto; border-radius:8px; margin-bottom:10px;">
            </a>
          {{ end }}

          <div style="font-weight:700; margin-bottom:6px;">
            <a href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
          </div>

          {{ with $p.Params.produkt.preis_basis }}
            <div style="color:#555; font-size:0.95em; margin-bottom:6px;">
              {{ if eq $p.Lang "de" }}Basispreis{{ else }}Base price{{ end }}:
              {{ printf "%.2f" . }} €
            </div>
          {{ end }}

          {{ with $p.Summary }}
            <div style="color:#444;">
              {{ . | plainify | truncate 160 }}
            </div>
          {{ end }}
        </div>
      {{ end }}
    </div>
  {{ end }}

</article>
{{ end }}
