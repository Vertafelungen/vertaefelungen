# .github/workflows/build-and-deploy-wissen.yml
# Version: 2025-09-20 07:59 (Europe/Berlin)
# Zweck: Build & Deploy der Wissensdatenbank

name: Build and Deploy Wissen

on:
  push:
    branches: [ main ]
  schedule:
    # Täglich um 02:15 UTC (ca. 15 Minuten nach dem Sheet-Sync) – Zeit bei Bedarf anpassen
    - cron: '15 2 * * *'
  workflow_dispatch:

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python 3.11
        uses: actions/setup-python@v3
        with:
          python-version: "3.11"

      - name: Install Requirements
        run: pip install -r requirements.txt

      - name: Build static HTML site
        run: python build_site.py

      - name: Deploy via SFTP to IONOS
        uses: matteodf/lftp-upload@v1
        with:
          host: "sftp://${{ secrets.SFTP_HOST }}"        # SFTP-Host (Domain) - ohne Port, Standard 22
          username: "${{ secrets.SFTP_USER }}"
          password: "${{ secrets.SFTP_PASSWORD }}"
          localDir: "wissen"       # Ordner mit dem gebauten Inhalt (inkl. Unterordnern de/, en/)
          remoteDir: "/wissen"     # Zielverzeichnis auf dem Server (Auslieferungsverzeichnis)
          forceSsl: "false"
          extraFlags: '-X *.md --delete'
